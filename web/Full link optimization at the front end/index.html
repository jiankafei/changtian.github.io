<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>Web全链路优化 | Zr的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="前言从访问一个页面到页面的呈现，要经历以下的过程：DNS查询-TCP连接 &amp;gt; 客户端http请求 &amp;gt; 服务端响应 &amp;gt; 客户端渲染下面就从整个过程分析下有哪些可以优化的地方和措施。">
<meta name="keywords" content="web">
<meta property="og:type" content="article">
<meta property="og:title" content="Web全链路优化">
<meta property="og:url" content="https://jiankafei.github.io/web/Full link optimization at the front end/index.html">
<meta property="og:site_name" content="Zr的博客">
<meta property="og:description" content="前言从访问一个页面到页面的呈现，要经历以下的过程：DNS查询-TCP连接 &amp;gt; 客户端http请求 &amp;gt; 服务端响应 &amp;gt; 客户端渲染下面就从整个过程分析下有哪些可以优化的地方和措施。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-11-21T04:45:54.608Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Web全链路优化">
<meta name="twitter:description" content="前言从访问一个页面到页面的呈现，要经历以下的过程：DNS查询-TCP连接 &amp;gt; 客户端http请求 &amp;gt; 服务端响应 &amp;gt; 客户端渲染下面就从整个过程分析下有哪些可以优化的地方和措施。">
    

    
        <link rel="alternate" href="/atom.xml" title="Zr的博客" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Zr的博客</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form" method="GET" action="https://www.baidu.com/s?">
    <input name="wd" type="text" class="search-form-input" placeholder="搜索" />
    <button type="submit" class="search-form-submit"></button>
</form>
<script>
(function ($) {
    $('.search-form').on('submit', function (e) {
        var keyword = $('.search-form-input[name="wd"]').val();
        window.location = 'https://www.baidu.com/s?wd=site:jiankafei.github.io ' + keyword;
        return false;
    });
})(jQuery);
</script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <form class="search-form" method="GET" action="https://www.baidu.com/s?">
    <input name="wd" type="text" class="search-form-input" placeholder="搜索" />
    <button type="submit" class="search-form-submit"></button>
</form>
<script>
(function ($) {
    $('.search-form').on('submit', function (e) {
        var keyword = $('.search-form-input[name="wd"]').val();
        window.location = 'https://www.baidu.com/s?wd=site:jiankafei.github.io ' + keyword;
        return false;
    });
})(jQuery);
</script>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/avatar.png" />
            <h2 id="name">Zr</h2>
            <h3 id="title">Web Developer &amp; Designer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>XianYang, China</span>
            <a id="follow" target="_blank" href="https://github.com/jiankafei">关注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                3
                <span>文章</span>
            </div>
            <div class="article-info-block">
                3
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/atom.xml" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-Web全链路优化" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            Web全链路优化
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/web/Full link optimization at the front end/">
            <time datetime="2017-11-21T03:52:15.000Z" itemprop="datePublished">2017-11-21</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/web/">web</a>
    </div>

                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/web/">web</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>从访问一个页面到页面的呈现，要经历以下的过程：<br>DNS查询-TCP连接 &gt; 客户端http请求 &gt; 服务端响应 &gt; 客户端渲染<br>下面就从整个过程分析下有哪些可以优化的地方和措施。</p>
<a id="more"></a>
<h2 id="DNS查询优化："><a href="#DNS查询优化：" class="headerlink" title="DNS查询优化："></a>DNS查询优化：</h2><p>client &gt; os &gt; hosts &gt; os发起DNS请求</p>
<p>DNS查询总是要经过上述过程的，不可避免。<br>可以优化的地方是前端的 DNS-Prefetch 链接预取。在页面的head头部加入：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">ref</span>=<span class="string">"prefetch"</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这样可以预查询DNS和预加载资源到缓存。</p>
<h2 id="请求速度优化："><a href="#请求速度优化：" class="headerlink" title="请求速度优化："></a>请求速度优化：</h2><h3 id="资源优化："><a href="#资源优化：" class="headerlink" title="资源优化："></a>资源优化：</h3><ol>
<li>对同一个域名的同类资源进行请求合并，减少http请求数，需要后端支持；</li>
<li>对资源进行压缩及合并处理，如果可以的话；</li>
<li>如果一次性加载的资源少，尽量使用一个cdn，如果加载的资源非常多，则可以启用多个cdn域名，从而突破前端连接数限制；</li>
<li>资源按需加载，比如在 SPA 单页应用中，如果单页应用比较大，就不要一次性加载全部资源和页面，而应该按需异步加载访问的页面组件。webpack提供了 Code Splitting 代码分割功能，Vue就使用该功能实现异步组件；</li>
</ol>
<h3 id="http协议选择："><a href="#http协议选择：" class="headerlink" title="http协议选择："></a>http协议选择：</h3><p>各大浏览器厂商都已经支持 http2了，如果可以，尽量启用 http2。http2 有很多优点：</p>
<ol>
<li>服务端推送，可以缓存；</li>
<li>多路复用：单连接并发多请求。基于流的实现；</li>
<li>头部压缩：使用 HPACK 算法压缩头部；</li>
<li>请求优先级和依赖性：优先级高的需要首先处理，优先级低的可以稍微排排队；</li>
<li>二进制文件，解析更有效率，更紧密，更不容易出错；</li>
</ol>
<h2 id="渲染优化："><a href="#渲染优化：" class="headerlink" title="渲染优化："></a>渲染优化：</h2><h3 id="script优化："><a href="#script优化：" class="headerlink" title="script优化："></a>script优化：</h3><ol>
<li>script标签放到body闭合标签前面，不阻塞页面渲染，加快页面显示；</li>
<li>永远只在必要的情况下使用框架和库，如果业务很小但是用了较大的库，即使是 jQuery 也是得不偿失的；</li>
<li>能异步加载和延迟加载的script就异步和延迟加载，比如统计代码；</li>
</ol>
<h3 id="css优化："><a href="#css优化：" class="headerlink" title="css优化："></a>css优化：</h3><ol>
<li>删除无用规则和重复规则；</li>
<li>可以考虑内联关键CSS；</li>
<li>避免@imports和Base64；<br>避免 Bas64 可以提高css文件的压缩比率；甚至在任何文件里都应该避免使用 Base64；</li>
<li>尽量少的使用耗性能的 css 属性和选择器，比如 * 通配符，从而加快CSSOM构建和渲染。css优化细节挺多的，这里不细说；</li>
<li>style标签放到head标签，防止页面的跳动渲染；</li>
</ol>
<h3 id="image优化："><a href="#image优化：" class="headerlink" title="image优化："></a>image优化：</h3><ol>
<li>尽量使用压缩比率高的格式，比如 webp；</li>
<li>对于图标，尽量使用svg或者iconfont字体图标。也可以使用兼容性较好的 css sprite；</li>
<li>尽量不要包含太多的 Base64 格式的图片，会降低文件压缩率；</li>
<li><p>如果页面有大量图片，建议做图片延迟加载和预加载；<br>在分页业务里，可以考虑使用图片预加载。<br>在一次性展示大量图片的页面里，可以考虑使用延迟加载。</p>
<p>注：更具体的图片优化，可以看这篇文章：<a href="http://www.cnblogs.com/wizcabbit/p/web-image-optimization.html" target="_blank" rel="noopener">图片优化</a></p>
</li>
</ol>
<h3 id="html优化："><a href="#html优化：" class="headerlink" title="html优化："></a>html优化：</h3><ol>
<li>尽量使用语义化标签，提高SEO优化；</li>
<li>对于不支持h5标签的浏览器采用html5.shim.js来支持；</li>
<li>标签不要嵌套过深；</li>
<li>对于移动端的响应式布局和高清显式，可以看我的原创项目<a href="https://github.com/jiankafei/flexible" target="_blank" rel="noopener">flexible</a>，该项目在生产环境下经历了多个版本，目前已经很稳定了，具体可以查看项目。</li>
</ol>
<h2 id="服务端："><a href="#服务端：" class="headerlink" title="服务端："></a>服务端：</h2><ol>
<li>避免不必要的重定向；</li>
<li>可以适当提高最大连接数，加快资源响应；</li>
<li>使用内容分发网络 CDN ，加快资源响应；</li>
<li>适当调节CDN的TTL值，增加缓存时间，提高缓存命中率；</li>
<li>开启 gzip 压缩；</li>
</ol>
<h2 id="缓存优化："><a href="#缓存优化：" class="headerlink" title="缓存优化："></a>缓存优化：</h2><ol>
<li>Last-Modified: 能初步检测文件是否更改，没更改则返回304，但是 Last-Modified 也有它自己的缺点，比如文件内容没改变，只是最后修改时间改变，还有它的检测时间是秒级的，还有它不能精确得到文件的最后修改时间，这些问题都会导致问题；</li>
<li>ETag：ETag可以解决Last-Modified的问题，ETag是内容相关的。所有把两者放在一起，可以很好的做到缓存优化；</li>
<li>Cache-Control: 用于代替 Expires，对于某些只需要在一定时间之后过期的资源来说，使用它最合适了；</li>
</ol>
<h2 id="其他："><a href="#其他：" class="headerlink" title="其他："></a>其他：</h2><ol>
<li>服务端的其他优化，比如负载均衡等，由于尚不了解，这里就不说了；</li>
<li>数据库也不甚了解，这里也不说了；</li>
<li>哪里说的不对，可以提issue交流；</li>
</ol>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">


    <div class="bdsharebuttonbox">
    <a href="#" class="bds_more" data-cmd="more">分享到：</a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间">QQ空间</a>
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
    <a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博">腾讯微博</a>
    <a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网">人人网</a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>
</div>
<script>
window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"16"},"share":{"bdSize":16}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script>
<style>
    .bdshare_popup_box {
        border-radius: 4px;
        border: #e1e1e1 solid 1px;
    }
    .bdshare-button-style0-16 a,
    .bdshare-button-style0-16 .bds_more {
        padding-left: 20px;
        margin: 6px 10px 6px 0;
    }
    .bdshare_dialog_list a,
    .bdshare_popup_list a,
    .bdshare_popup_bottom a {
        font-family: 'Microsoft Yahei';
    }
    .bdshare_popup_top {
        display: none;
    }
    .bdshare_popup_bottom {
        height: auto;
        padding: 5px;
    }
</style>


</div>

            
        </footer>
    </div>
    
        
<nav id="article-nav">
    
    
        <a href="/css/flexLayout/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">flex布局解析</div>
        </a>
    
</nav>


    
</article>


    
</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/web/Full link optimization at the front end/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/web/">web</a></p>
                            <p class="item-title"><a href="/web/Full link optimization at the front end/" class="title">Web全链路优化</a></p>
                            <p class="item-date"><time datetime="2017-11-21T03:52:15.000Z" itemprop="datePublished">2017-11-21</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/css/flexLayout/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/css/">css</a></p>
                            <p class="item-title"><a href="/css/flexLayout/" class="title">flex布局解析</a></p>
                            <p class="item-date"><time datetime="2016-08-12T00:15:29.000Z" itemprop="datePublished">2016-08-12</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/js/flexible/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/js/">js</a></p>
                            <p class="item-title"><a href="/js/flexible/" class="title">移动端web高清屏显示及伸缩布局方案(原创)</a></p>
                            <p class="item-date"><time datetime="2016-08-11T02:41:29.000Z" itemprop="datePublished">2016-08-11</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/css/">css</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/js/">js</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">2</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/">js</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/web/" style="font-size: 10px;">web</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 王勒<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        


    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>